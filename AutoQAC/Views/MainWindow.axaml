<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AutoQAC.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" 
        d:DesignWidth="900" d:DesignHeight="600"
        x:Class="AutoQAC.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="AutoQAC - Plugin Auto Cleaning Tool"
        Width="900" Height="600"
        MinWidth="700" MinHeight="400"
        Icon="/Assets/avalonia-logo.ico">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Exit" Command="{Binding ExitCommand}" />
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}" />
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="0,1,0,0"
                Padding="5">
            <TextBlock Text="{Binding StatusText}" />
        </Border>

        <!-- Main Content -->
        <Grid Margin="10" RowDefinitions="Auto,*,Auto">

            <!-- Configuration Panel -->
            <StackPanel Grid.Row="0" Spacing="10">
                <TextBlock Text="Configuration"
                           FontSize="16" FontWeight="Bold" />

                <!-- Game Selection -->
                <Grid ColumnDefinitions="120,*,Auto">
                    <TextBlock Grid.Column="0" Text="Game:"
                               VerticalAlignment="Center" />
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding AvailableGames}"
                              SelectedItem="{Binding SelectedGame}"
                              HorizontalAlignment="Stretch">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Converter={StaticResource GameTypeDisplayConverter}}" />
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    <TextBlock Grid.Column="2"
                               Text="{Binding IsMutagenSupported, StringFormat='Mutagen: {0}'}"
                               VerticalAlignment="Center"
                               Margin="10,0,0,0"
                               FontSize="11"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                </Grid>

                <Grid ColumnDefinitions="120,*,Auto">
                    <TextBlock Grid.Column="0" Text="Load Order:"
                               VerticalAlignment="Center" />
                    <TextBox Grid.Column="1"
                             Text="{Binding LoadOrderPath}"
                             IsReadOnly="True"
                             Watermark="Not configured" />
                    <Button Grid.Column="2"
                            Content="Browse..."
                            Command="{Binding ConfigureLoadOrderCommand}"
                            Margin="5,0,0,0" />
                </Grid>

                <Grid ColumnDefinitions="120,*,Auto">
                    <TextBlock Grid.Column="0" Text="xEdit:"
                               VerticalAlignment="Center" />
                    <TextBox Grid.Column="1"
                             Text="{Binding XEditPath}"
                             IsReadOnly="True"
                             Watermark="Not configured" />
                    <Button Grid.Column="2"
                            Content="Browse..."
                            Command="{Binding ConfigureXEditCommand}"
                            Margin="5,0,0,0" />
                </Grid>

                <Grid ColumnDefinitions="120,*,Auto">
                    <TextBlock Grid.Column="0" Text="Mod Organizer 2:"
                               VerticalAlignment="Center" />
                    <TextBox Grid.Column="1"
                             Text="{Binding MO2Path}"
                             IsReadOnly="True"
                             Watermark="Optional - for MO2 mode" />
                    <Button Grid.Column="2"
                            Content="Browse..."
                            Command="{Binding ConfigureMO2Command}"
                            Margin="5,0,0,0" />
                </Grid>

                <StackPanel Orientation="Horizontal" Spacing="10">
                    <CheckBox Content="MO2 Mode"
                              IsChecked="{Binding MO2ModeEnabled}" />
                    <CheckBox Content="Partial Forms (Experimental)"
                              IsChecked="{Binding PartialFormsEnabled}"
                              Command="{Binding TogglePartialFormsCommand}" />
                    <Button Content="Reset Settings"
                            Command="{Binding ResetSettingsCommand}"
                            VerticalAlignment="Center" />
                </StackPanel>
            </StackPanel>

            <!-- Plugin List -->
            <Border Grid.Row="1"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="0,10,0,10">
                <Grid RowDefinitions="Auto,*">
                    <TextBlock Grid.Row="0"
                               Text="Plugins to Clean"
                               FontSize="14" FontWeight="SemiBold"
                               Margin="10,5" />

                    <ListBox Grid.Row="1"
                             ItemsSource="{Binding PluginsToClean}"
                             SelectedItem="{Binding SelectedPlugin}"
                             Margin="5">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding FileName}" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Control Buttons -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Spacing="10">
                <Button Content="Start Cleaning"
                        Command="{Binding StartCleaningCommand}"
                        IsEnabled="{Binding CanStartCleaning}"
                        MinWidth="120" />
                <Button Content="Stop"
                        Command="{Binding StopCleaningCommand}"
                        IsEnabled="{Binding IsCleaning}"
                        MinWidth="120" />
            </StackPanel>
        </Grid>
    </DockPanel>
</Window>
