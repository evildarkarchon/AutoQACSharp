---
phase: 06-ui-polish-monitoring
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - AutoQAC/ViewModels/AboutViewModel.cs
  - AutoQAC/Views/AboutWindow.axaml
  - AutoQAC/Views/AboutWindow.axaml.cs
  - AutoQAC/ViewModels/MainWindow/CleaningCommandsViewModel.cs
  - AutoQAC/ViewModels/MainWindowViewModel.cs
  - AutoQAC/Views/MainWindow.axaml.cs
  - AutoQAC/AutoQAC.csproj
  - AutoQAC/App.axaml.cs
  - AutoQAC/Services/Cleaning/CleaningOrchestrator.cs
autonomous: true

must_haves:
  truths:
    - "User can open About dialog from Help > About menu and see app version, build date, .NET runtime version, and Avalonia/ReactiveUI library versions"
    - "User can click Check for Updates button in About dialog and see whether a newer version is available or an error message if the check fails"
    - "About dialog shows clickable links to GitHub repository, GitHub issues, and xEdit project"
    - "Application startup logs xEdit path, game type, MO2 status, and load order size"
    - "Session completion logs a summary of results (plugins processed, cleaned, skipped, failed, ITMs, UDRs, navmeshes, duration, cancellation status)"
  artifacts:
    - path: "AutoQAC/ViewModels/AboutViewModel.cs"
      provides: "About dialog ViewModel with version info, update check, and links"
      min_lines: 80
    - path: "AutoQAC/Views/AboutWindow.axaml"
      provides: "About dialog XAML with centered layout"
      min_lines: 40
    - path: "AutoQAC/Views/AboutWindow.axaml.cs"
      provides: "About window code-behind with link click handlers"
      min_lines: 10
  key_links:
    - from: "AutoQAC/ViewModels/MainWindow/CleaningCommandsViewModel.cs"
      to: "AboutWindow"
      via: "ShowAboutInteraction from parent"
      pattern: "ShowAboutInteraction"
    - from: "AutoQAC/App.axaml.cs"
      to: "ILoggingService"
      via: "Startup logging call"
      pattern: "Session Start|xEdit Path|Game Type"
    - from: "AutoQAC/Services/Cleaning/CleaningOrchestrator.cs"
      to: "ILoggingService"
      via: "Session summary logging after cleaning completes"
      pattern: "Session Complete|Plugins processed"
---

<objective>
Add an About dialog with version/build/update info and improve application logging at startup and session completion. The About dialog uses a classic centered layout with app icon, version info, library versions, links, and a GitHub release check button. Logging improvements add structured startup diagnostics and cleaning session summaries.

Purpose: Give users version info and update checking (UI-01) and give developers/troubleshooters diagnostic logging (UI-03) to understand application state at startup and cleaning results at session end.

Output: AboutWindow + AboutViewModel, updated CleaningCommandsViewModel for About interaction, startup logging in App.axaml.cs, session summary logging in CleaningOrchestrator.
</objective>

<execution_context>
@C:\Users\evild\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\evild\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-ui-polish-monitoring/06-RESEARCH.md
@.planning/phases/06-ui-polish-monitoring/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: About dialog (ViewModel, View, interaction wiring)</name>
  <files>
    AutoQAC/ViewModels/AboutViewModel.cs
    AutoQAC/Views/AboutWindow.axaml
    AutoQAC/Views/AboutWindow.axaml.cs
    AutoQAC/ViewModels/MainWindow/CleaningCommandsViewModel.cs
    AutoQAC/ViewModels/MainWindowViewModel.cs
    AutoQAC/Views/MainWindow.axaml.cs
    AutoQAC/AutoQAC.csproj
  </files>
  <action>
    **Step 1: Add build date MSBuild property to AutoQAC.csproj.**

    Add inside the existing PropertyGroup:
    ```xml
    <AssemblyMetadata Include="BuildDate" Value="$([System.DateTime]::UtcNow.ToString('yyyy-MM-dd'))" />
    ```
    This embeds the build date as an AssemblyMetadataAttribute since .NET deterministic builds don't include timestamps.

    **Step 2: Create AboutViewModel.cs** in AutoQAC/ViewModels/.

    AboutViewModel inherits ViewModelBase. Properties (all read-only):
    - `AppVersion` (string): From Assembly.GetEntryAssembly().GetName().Version, formatted as "Major.Minor.Build"
    - `InformationalVersion` (string): From AssemblyInformationalVersionAttribute (includes git hash if present)
    - `BuildDate` (string): From AssemblyMetadataAttribute("BuildDate") -- read via assembly.GetCustomAttributes
    - `DotNetVersion` (string): From RuntimeInformation.FrameworkDescription (returns ".NET 10.0.X")
    - `AvaloniaVersion` (string): From typeof(Avalonia.Application).Assembly.GetName().Version
    - `ReactiveUIVersion` (string): From typeof(ReactiveUI.ReactiveObject).Assembly.GetName().Version
    - `GitHubUrl` (string): "https://github.com/evildarkarchon/AutoQACSharp" (constant -- verify the actual repo owner from the project)
    - `GitHubIssuesUrl` (string): GitHubUrl + "/issues"
    - `XEditUrl` (string): "https://github.com/TES5Edit/TES5Edit" (xEdit project)
    - `UpdateStatusText` (string, reactive): Shows update check result or error
    - `IsCheckingUpdate` (bool, reactive): True while checking
    - `UpdateAvailable` (bool, reactive): True if newer version found
    - `LatestVersionUrl` (string?, reactive): URL to the release page if update available

    Commands:
    - `CheckForUpdateCommand`: ReactiveCommand.CreateFromTask, canExecute when !IsCheckingUpdate
    - `OpenGitHubCommand`: ReactiveCommand.Create -- opens GitHubUrl via Process.Start
    - `OpenIssuesCommand`: ReactiveCommand.Create -- opens GitHubIssuesUrl via Process.Start
    - `OpenXEditCommand`: ReactiveCommand.Create -- opens XEditUrl via Process.Start
    - `OpenLatestReleaseCommand`: ReactiveCommand.Create -- opens LatestVersionUrl via Process.Start (only enabled when UpdateAvailable)

    For link opening, use: `Process.Start(new ProcessStartInfo(url) { UseShellExecute = true })`

    CheckForUpdateAsync implementation:
    1. Set IsCheckingUpdate = true, UpdateStatusText = "Checking..."
    2. Create HttpClient with User-Agent "AutoQAC/{version}" and 10-second timeout
    3. GET https://api.github.com/repos/evildarkarchon/AutoQACSharp/releases/latest
    4. Parse JSON with System.Text.Json: extract tag_name and html_url
    5. Strip leading 'v' from tag_name, compare with System.Version against AppVersion
    6. Set UpdateAvailable, LatestVersionUrl, UpdateStatusText accordingly
    7. Error handling: HttpRequestException -> "Network error -- check your connection", TaskCanceledException -> "Request timed out", JsonException -> "Could not parse response", other -> generic message
    8. Set IsCheckingUpdate = false in finally block

    NOTE: Use a static HttpClient instance (or IHttpClientFactory if registered). The static approach is fine for this single-use scenario. Add User-Agent header to avoid GitHub API 403s.

    **Step 3: Create AboutWindow.axaml** in AutoQAC/Views/.

    Per locked decision: classic centered layout, app icon at top, version info stacked below, links at bottom.

    Layout (Window, centered, ~400x450, not resizable, WindowStartupLocation=CenterOwner):
    - Top: App icon (use the existing avalonia-logo.ico from Assets/ for now), centered, 64x64
    - Below icon: App name "AutoQAC" in bold 20pt
    - Version info stacked with labels:
      - "Version: {AppVersion}" (or InformationalVersion)
      - "Build Date: {BuildDate}"
      - ".NET Runtime: {DotNetVersion}"
      - "Avalonia: {AvaloniaVersion}"
      - "ReactiveUI: {ReactiveUIVersion}"
    - Separator line
    - Update check section:
      - Button "Check for Updates" with Command=CheckForUpdateCommand
      - TextBlock showing UpdateStatusText (only visible when not empty)
      - Button "View Release" with Command=OpenLatestReleaseCommand (only visible when UpdateAvailable)
    - Separator line
    - Links section (horizontal StackPanel):
      - Button "GitHub" (styled as hyperlink) with Command=OpenGitHubCommand
      - Button "Report Bug" with Command=OpenIssuesCommand
      - Button "xEdit Project" with Command=OpenXEditCommand
    - Bottom: Close button

    Set x:DataType="vm:AboutViewModel" for compiled bindings.

    **Step 4: Create AboutWindow.axaml.cs** -- minimal code-behind.
    - Parameterless constructor calling InitializeComponent()
    - Constructor accepting AboutViewModel, sets DataContext

    **Step 5: Wire the About interaction.**

    In MainWindowViewModel: Add a new Interaction:
    ```csharp
    public Interaction<Unit, Unit> ShowAboutInteraction { get; } = new();
    ```

    Pass ShowAboutInteraction to CleaningCommandsViewModel.

    In CleaningCommandsViewModel: Update ShowAbout method to call ShowAboutInteraction.Handle(Unit.Default) instead of just setting StatusText.

    In MainWindow.axaml.cs: Register the interaction handler:
    ```csharp
    viewModel.ShowAboutInteraction.RegisterHandler(ShowAboutAsync);
    ```

    ShowAboutAsync creates AboutViewModel, creates AboutWindow, calls ShowDialog(this).

    **Step 6: No DI registration needed** -- AboutViewModel is created directly in the interaction handler (like SettingsViewModel pattern).
  </action>
  <verify>
    `dotnet build j:/AutoQACSharp` succeeds. The About dialog files exist. Build date is embedded in assembly metadata.
  </verify>
  <done>
    About dialog opens from Help > About, shows version, build date, .NET version, Avalonia/ReactiveUI versions, has working GitHub/Issues/xEdit links, and a Check for Updates button that hits GitHub API and reports results.
  </done>
</task>

<task type="auto">
  <name>Task 2: Startup and session completion logging</name>
  <files>
    AutoQAC/App.axaml.cs
    AutoQAC/Services/Cleaning/CleaningOrchestrator.cs
  </files>
  <action>
    **Step 1: Add startup logging in App.axaml.cs.**

    After the MainWindow is created and services are resolved (after `desktop.MainWindow = mainWindow;`), add a startup logging block. Read the current state from IStateService and log:

    ```
    logger.Information("=== AutoQAC Session Start ===");
    logger.Information("Version: {Version}", AppVersion from assembly);
    logger.Information(".NET Runtime: {Runtime}", RuntimeInformation.FrameworkDescription);
    logger.Information("xEdit Path: {XEditPath}", stateService.CurrentState.XEditExecutablePath ?? "(not configured)");
    logger.Information("Game Type: {GameType}", stateService.CurrentState.CurrentGameType);
    logger.Information("MO2 Mode: {Mo2Mode}", stateService.CurrentState.Mo2ModeEnabled);
    ```

    Note: Plugin count won't be available at startup since InitializeAsync runs asynchronously. Log load order size after InitializeAsync completes. The simplest approach: log what's immediately available (xEdit, game type, MO2 mode) at startup. The plugin count will be logged when a cleaning session starts (already captured by the orchestrator).

    Use `System.Runtime.InteropServices.RuntimeInformation` for .NET version. Use Assembly.GetEntryAssembly() for app version.

    **Step 2: Add session completion summary logging in CleaningOrchestrator.**

    Read the current CleaningOrchestrator.cs first. Find where the cleaning session completes (after all plugins are processed, before state is updated to IsCleaning=false). Add structured logging:

    ```
    _logger.Information("=== AutoQAC Session Complete ===");
    _logger.Information("Duration: {Duration}", session.Duration);
    _logger.Information("Plugins processed: {Total} (Cleaned: {Cleaned}, Skipped: {Skipped}, Failed: {Failed})",
        results.Count, cleanedCount, skippedCount, failedCount);
    _logger.Information("ITMs removed: {Itm}, UDRs fixed: {Udr}, Navmeshes: {Nav}",
        totalItms, totalUdrs, totalNavs);
    if (wasCancelled)
        _logger.Information("Session was cancelled by user");
    ```

    The exact field names depend on the CleaningSessionResult model and how the orchestrator builds it. Read the orchestrator code to find the right insertion point and available data.

    Also log the xEdit command being executed for each plugin (if not already logged). Check if CleaningService or XEditCommandBuilder already logs the command. If not, add:
    ```
    _logger.Debug("xEdit command: {Command} {Arguments}", processStartInfo.FileName, processStartInfo.Arguments);
    ```

    **Step 3: Verify log output.**

    Run `dotnet build` to confirm compilation. The actual log output can be verified by checking the Serilog file sink output in the logs/ directory when the app runs.
  </action>
  <verify>
    `dotnet build j:/AutoQACSharp` succeeds. `dotnet test j:/AutoQACSharp` passes all tests (logging changes should not break tests). Grep for "Session Start" in App.axaml.cs and "Session Complete" in CleaningOrchestrator.cs confirms the logging code exists.
  </verify>
  <done>
    Application startup logs version, .NET runtime, xEdit path, game type, and MO2 status. Cleaning session completion logs duration, plugin counts (cleaned/skipped/failed), ITM/UDR/navmesh totals, and cancellation status.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build j:/AutoQACSharp` -- zero errors
2. `dotnet test j:/AutoQACSharp` -- all tests pass
3. AboutViewModel.cs exists with version properties, update check command, and link commands
4. AboutWindow.axaml exists with classic centered layout (icon, versions, links, update check)
5. About interaction wired: Help > About opens the dialog
6. App.axaml.cs contains startup logging with "Session Start" marker
7. CleaningOrchestrator.cs contains session summary logging with "Session Complete" marker
</verification>

<success_criteria>
- About dialog shows app version, build date, .NET runtime version, Avalonia version, ReactiveUI version
- About dialog has clickable links to GitHub repo, GitHub issues, and xEdit project
- Check for Updates button hits GitHub API and shows result (update available, up to date, or error)
- Startup logs include xEdit path, game type, MO2 status
- Session completion logs include plugin counts, cleaning stats, duration, cancellation status
- All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-ui-polish-monitoring/06-02-SUMMARY.md`
</output>
